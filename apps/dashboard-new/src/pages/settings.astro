---
import LayoutSidebar from '../app/LayoutSidebar.astro';
---

<LayoutSidebar>
	<div class="space-y-6">
		<!-- Header -->
		<div>
			<h1 class="text-2xl font-bold text-white flex items-center gap-2">
				<span class="text-3xl">‚öôÔ∏è</span>
				Settings
			</h1>
			<p class="text-secondary mt-1">Configure your ClawFi dashboard</p>
		</div>

		<!-- General Settings -->
		<div class="card-glass overflow-hidden">
			<div class="px-6 py-4 border-b border-white/10">
				<h2 class="text-lg font-semibold text-white flex items-center gap-2">
					<span>üõ†Ô∏è</span>
					General
				</h2>
			</div>
			<div class="p-6 space-y-4">
				<div>
					<label class="block text-sm font-medium text-secondary mb-2">API URL</label>
					<input
						type="text"
						id="api-url"
						class="input-glass w-full"
						readonly
					/>
				</div>
				<div>
					<label class="block text-sm font-medium text-secondary mb-2">Dashboard Version</label>
					<input
						type="text"
						value="v0.4.2"
						class="input-glass w-full"
						readonly
					/>
				</div>
			</div>
		</div>

		<!-- Extension Token -->
		<div class="card-glass overflow-hidden">
			<div class="px-6 py-4 border-b border-white/10">
				<h2 class="text-lg font-semibold text-white flex items-center gap-2">
					<span>üß©</span>
					Browser Extension
				</h2>
			</div>
			<div class="p-6 space-y-4">
				<div>
					<label class="block text-sm font-medium text-secondary mb-2">Auth Token (for ClawFi Extension)</label>
					<div class="flex gap-2">
						<input
							type="text"
							id="auth-token"
							class="input-glass flex-1 font-mono text-xs"
							readonly
						/>
						<button id="copy-token-btn" class="btn-glass btn-glass-primary whitespace-nowrap">
							Copy Token
						</button>
					</div>
					<p class="text-xs text-tertiary mt-2">Paste this token in the ClawFi browser extension settings</p>
				</div>
				
				<div class="pt-4 border-t border-white/10">
					<a 
						href="chrome://extensions" 
						class="text-primary text-sm hover:underline flex items-center gap-2"
					>
						<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
						</svg>
						Open Chrome Extensions
					</a>
				</div>
			</div>
		</div>

		<!-- Notifications -->
		<div class="card-glass overflow-hidden">
			<div class="px-6 py-4 border-b border-white/10">
				<h2 class="text-lg font-semibold text-white flex items-center gap-2">
					<span>üîî</span>
					Notifications
				</h2>
			</div>
			<div class="p-6 space-y-4">
				<div class="flex items-center justify-between p-4 bg-white/5 rounded-xl">
					<div>
						<p class="font-medium text-white">Browser Notifications</p>
						<p class="text-sm text-secondary">Get notified of price alerts and signals</p>
					</div>
					<button id="enable-notifications" class="btn-glass btn-glass-primary">
						Enable
					</button>
				</div>
				<div class="flex items-center justify-between p-4 bg-white/5 rounded-xl">
					<div>
						<p class="font-medium text-white">Telegram Bot</p>
						<p class="text-sm text-secondary">Receive signals via Telegram</p>
					</div>
					<span class="badge-glass text-xs">
						Configure in .env
					</span>
				</div>
				<div class="flex items-center justify-between p-4 bg-white/5 rounded-xl">
					<div>
						<p class="font-medium text-white">Discord Webhook</p>
						<p class="text-sm text-secondary">Send alerts to Discord channel</p>
					</div>
					<span class="badge-glass text-xs">
						Configure in .env
					</span>
				</div>
			</div>
		</div>

		<!-- Data Management -->
		<div class="card-glass overflow-hidden">
			<div class="px-6 py-4 border-b border-white/10">
				<h2 class="text-lg font-semibold text-white flex items-center gap-2">
					<span>üíæ</span>
					Data Management
				</h2>
			</div>
			<div class="p-6 space-y-4">
				<div class="flex items-center justify-between p-4 bg-white/5 rounded-xl">
					<div>
						<p class="font-medium text-white">Export Watchlist</p>
						<p class="text-sm text-secondary">Download your watchlist as JSON</p>
					</div>
					<button id="export-watchlist" class="btn-glass">
						Export
					</button>
				</div>
				<div class="flex items-center justify-between p-4 bg-white/5 rounded-xl">
					<div>
						<p class="font-medium text-white">Export Alerts</p>
						<p class="text-sm text-secondary">Download your price alerts as JSON</p>
					</div>
					<button id="export-alerts" class="btn-glass">
						Export
					</button>
				</div>
			</div>
		</div>

		<!-- Danger Zone -->
		<div class="card-glass overflow-hidden border-red-500/30">
			<div class="px-6 py-4 border-b border-red-500/30 bg-red-500/10">
				<h2 class="text-lg font-semibold text-red-400 flex items-center gap-2">
					<span>‚ö†Ô∏è</span>
					Danger Zone
				</h2>
			</div>
			<div class="p-6 space-y-4">
				<div class="flex items-center justify-between p-4 bg-red-500/5 rounded-xl border border-red-500/20">
					<div>
						<p class="font-medium text-white">Clear Watchlist</p>
						<p class="text-sm text-secondary">Remove all tokens from your watchlist</p>
					</div>
					<button id="clear-watchlist" class="btn-glass hover:bg-red-500/20 hover:border-red-500/50">
						Clear
					</button>
				</div>
				<div class="flex items-center justify-between p-4 bg-red-500/5 rounded-xl border border-red-500/20">
					<div>
						<p class="font-medium text-white">Clear All Alerts</p>
						<p class="text-sm text-secondary">Remove all price alerts</p>
					</div>
					<button id="clear-alerts" class="btn-glass hover:bg-red-500/20 hover:border-red-500/50">
						Clear
					</button>
				</div>
				<div class="flex items-center justify-between p-4 bg-red-500/5 rounded-xl border border-red-500/20">
					<div>
						<p class="font-medium text-white">Sign Out</p>
						<p class="text-sm text-secondary">End your current session</p>
					</div>
					<button id="logout-btn" class="btn-glass hover:bg-red-500/20 hover:border-red-500/50">
						Sign Out
					</button>
				</div>
			</div>
		</div>

		<!-- About -->
		<div class="card-glass p-6 text-center">
			<div class="text-4xl mb-4">ü¶Ä</div>
			<h3 class="text-xl font-bold text-white">ClawFi Dashboard</h3>
			<p class="text-secondary text-sm mt-1">Your Degen Trading Command Center</p>
			<div class="flex items-center justify-center gap-4 mt-4">
				<a href="https://github.com/clawfiai/clawfi" target="_blank" rel="noopener noreferrer" class="text-tertiary hover:text-white transition-colors">
					GitHub
				</a>
				<span class="text-tertiary">‚Ä¢</span>
				<a href="https://twitter.com/clawfiai" target="_blank" rel="noopener noreferrer" class="text-tertiary hover:text-white transition-colors">
					Twitter
				</a>
				<span class="text-tertiary">‚Ä¢</span>
				<a href="https://docs.clawfi.ai" target="_blank" rel="noopener noreferrer" class="text-tertiary hover:text-white transition-colors">
					Docs
				</a>
			</div>
			<p class="text-tertiary text-xs mt-4">v0.4.2 ‚Ä¢ Built with Astro & React</p>
		</div>
	</div>
</LayoutSidebar>

<script>
	const token = localStorage.getItem('clawfi_token');
	if (!token) window.location.href = '/login';
	
	const API_URL = 'https://api.clawfi.ai';
	const apiUrlInput = document.getElementById('api-url');
	if (apiUrlInput) {
		(apiUrlInput as HTMLInputElement).value = API_URL;
	}
	
	// Show auth token
	const authTokenInput = document.getElementById('auth-token');
	if (authTokenInput && token) {
		(authTokenInput as HTMLInputElement).value = token;
	}
	
	// Copy token button
	document.getElementById('copy-token-btn')?.addEventListener('click', async () => {
		const btn = document.getElementById('copy-token-btn');
		if (token && btn) {
			await navigator.clipboard.writeText(token);
			btn.textContent = 'Copied!';
			btn.classList.add('bg-emerald-500/30', 'border-emerald-500/50');
			setTimeout(() => {
				btn.textContent = 'Copy Token';
				btn.classList.remove('bg-emerald-500/30', 'border-emerald-500/50');
			}, 2000);
		}
	});
	
	// Notifications
	document.getElementById('enable-notifications')?.addEventListener('click', async () => {
		const btn = document.getElementById('enable-notifications');
		if ('Notification' in window) {
			const permission = await Notification.requestPermission();
			if (permission === 'granted') {
				new Notification('ClawFi', { body: 'Notifications enabled!', icon: '/favicon.svg' });
				if (btn) {
					btn.textContent = 'Enabled ‚úì';
					btn.classList.add('bg-emerald-500/30', 'border-emerald-500/50');
				}
			}
		}
	});
	
	// Export watchlist
	document.getElementById('export-watchlist')?.addEventListener('click', () => {
		const data = localStorage.getItem('clawfi_watchlist');
		if (data) {
			const blob = new Blob([data], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = 'clawfi-watchlist.json';
			a.click();
		}
	});
	
	// Export alerts
	document.getElementById('export-alerts')?.addEventListener('click', () => {
		const data = localStorage.getItem('clawfi_alerts');
		if (data) {
			const blob = new Blob([data], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = 'clawfi-alerts.json';
			a.click();
		}
	});
	
	// Clear watchlist
	document.getElementById('clear-watchlist')?.addEventListener('click', () => {
		if (confirm('Are you sure you want to clear your entire watchlist?')) {
			localStorage.removeItem('clawfi_watchlist');
			alert('Watchlist cleared');
		}
	});
	
	// Clear alerts
	document.getElementById('clear-alerts')?.addEventListener('click', () => {
		if (confirm('Are you sure you want to clear all your price alerts?')) {
			localStorage.removeItem('clawfi_alerts');
			alert('Alerts cleared');
		}
	});
	
	// Logout
	document.getElementById('logout-btn')?.addEventListener('click', () => {
		localStorage.removeItem('clawfi_token');
		window.location.href = '/login';
	});
</script>
